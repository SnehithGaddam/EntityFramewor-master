# Batch SaveChanges

## Description

The EF `BatchSaveChanges` extension method combines SQL generated by the `SaveChanges` method. Less database round-trips are performed which improve your application performance.


```csharp
// var affectedRows = context.SaveChanges();
var affectedRows = context.BatchSaveChanges();
```
[Try it](https://dotnetfiddle.net/hHLUnp)

### Performance Comparison

| Operations       | 1,000 Entities | 2,000 Entities | 5,000 Entities |
| :--------------- | -------------: | -------------: | -------------: |
| SaveChanges      | 1,200 ms       | 2,400 ms       | 6,000 ms       |
| BatchSaveChanges | 75 ms          | 150 ms         | 500 ms         |

[Try this benchmark online](https://dotnetfiddle.net/qCVyzm)

> HINT: A lot of factors might affect the benchmark time such as index, column type, latency, throttling, etc.

### FAQ

#### What is supported?
- Entity Framework 6
- SQL Server
- Everything `SaveChanges` support

_EF Core support is under development_

#### Why BatchSaveChanges is faster than SaveChanges?
The `SaveChanges` method makes it quite slow/impossible to handle a scenario that requires to save a lot of entities due to the number of database round-trips required. The `SaveChanges` perform one database round-trip for every entity to insert. So, if you need to insert 10,000 entities, 10,000 database round-trips will be performed which is **INSANELY** slow.

The `BatchSaveChanges` in counterpart requires the minimum database round-trips as possible. By combining queries in fewer commands, you might end up having only 100 database round-trips instead of 10,000.

#### When should I use BatchSaveChanges over SaveChanges?
Always!

Under the hood, `BatchSaveChanges` use `SaveChanges` for saving 1 entity but will outperform in all other cases by combining queries to execute.

Always use `BatchSaveChanges`, it the best of both worlds.

#### When should I use BatchSaveChanges over BulkSaveChanges?
`BatchSaveChanges` becomes slower and slower in comparison to `BulkSaveChanges` when the number of entities to save grows due to the `ChangeTracker`.

After a few thousand of entities, we recommend using `BulkSaveChanges` which is a more scalable solution. But be aware, the SQL used is no longer the same as `SaveChanges`.

### Advantages
- Easy to use
- Increase performance
- Increase application responsiveness
- Reduce database load
- Reduce database round-trips

## Documentation

### BatchSaveChanges

###### Methods

| Name | Description | Example |
| :--- | :---------- | :------ |
| `BatchSaveChanges()` | Saves all changes made in this context to the underlying database by combining SQL generated. | [Try it](https://dotnetfiddle.net/kCl8oB) |
| `BatchSaveChangesAsync()` | Saves all changes asynchronously made in this context to the underlying database by combining SQL generated. | |
| `BatchSaveChangesAsync(cancellationToken)` | Saves all changes asynchronously made in this context to the underlying database by combining SQL generated. | |

## Limitations

- Support EF6 only
- Support SQL Server only
- Might be slower on SQL Express

_EF Core and more provider are under development._
